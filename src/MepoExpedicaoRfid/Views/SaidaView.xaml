<UserControl x:Class="MepoExpedicaoRfid.Views.SaidaView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                 mc:Ignorable="d">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Saída RFID" Style="{StaticResource H1}" Margin="0,0,0,16"/>

          <Grid Grid.Row="1">

<Grid>
  <Grid.RowDefinitions>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="*"/>
  </Grid.RowDefinitions>

  <Border Style="{StaticResource CardBorder}">
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="1*"/>
      </Grid.ColumnDefinitions>

      <StackPanel>
        <TextBlock Text="Pedido / Sessão" Style="{StaticResource Muted}"/>
        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
          <ComboBox Width="140"
                    ItemsSource="{Binding Origens}"
                    SelectedItem="{Binding OrigemSelecionada, Mode=TwoWay}"
                    Margin="0,0,10,0"/>
          <TextBox Width="220"
                   Text="{Binding PedidoNumero, UpdateSourceTrigger=PropertyChanged}"
                   materialDesign:HintAssist.Hint="Número do pedido"
                   Margin="0,0,10,0"/>
          <Button Content="Criar/Abrir Sessão" Command="{Binding CriarOuAbrirSessao}" Padding="12,6" Background="#4299E1" Foreground="White"/>
        </StackPanel>
        <TextBlock Text="{Binding SessionId, StringFormat=Sessão: {0}}" Opacity="0.75" Margin="0,10,0,0"/>
      </StackPanel>

      <StackPanel Grid.Column="1" HorizontalAlignment="Right">
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
          <Button Content="Iniciar" Command="{Binding IniciarLeitura}" Padding="12,6" Margin="0,0,8,0"/>
          <Button Content="Pausar" Command="{Binding PausarLeitura}" Padding="12,6"/>
        </StackPanel>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
          <Button Content="Finalizar" Command="{Binding Finalizar}" Padding="12,6" Background="#4299E1" Foreground="White" Margin="0,0,8,0"/>
          <Button Content="Cancelar" Command="{Binding Cancelar}" Padding="12,6"/>
        </StackPanel>
      </StackPanel>
    </Grid>
  </Border>

  <Grid Grid.Row="1" Margin="0,0,0,12">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="1*"/>
      <ColumnDefinition Width="1*"/>
      <ColumnDefinition Width="1*"/>
    </Grid.ColumnDefinitions>

    <Border Style="{StaticResource CardBorder}" Grid.Column="0">
      <StackPanel>
        <TextBlock Text="Tags lidas" Style="{StaticResource Muted}"/>
        <TextBlock Text="{Binding TotalTags}" FontSize="34" FontWeight="Bold" Margin="0,6,0,0"/>
      </StackPanel>
    </Border>

    <Border Style="{StaticResource CardBorder}" Grid.Column="1" Margin="12,0,12,12">
      <StackPanel>
        <TextBlock Text="SKUs únicos" Style="{StaticResource Muted}"/>
        <TextBlock Text="{Binding SkusUnicos}" FontSize="34" FontWeight="Bold" Margin="0,6,0,0"/>
      </StackPanel>
    </Border>

    <Border Style="{StaticResource CardBorder}" Grid.Column="2">
      <StackPanel>
        <TextBlock Text="Lotes únicos" Style="{StaticResource Muted}"/>
        <TextBlock Text="{Binding LotesUnicos}" FontSize="34" FontWeight="Bold" Margin="0,6,0,0"/>
      </StackPanel>
    </Border>
  </Grid>

  <Grid Grid.Row="2">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="2*"/>
      <ColumnDefinition Width="1*"/>
    </Grid.ColumnDefinitions>

    <Border Style="{StaticResource CardBorder}" Grid.Column="0" Margin="0,0,12,0">
      <StackPanel>
        <TextBlock Text="Resumo por SKU/Lote" FontWeight="SemiBold" Margin="0,0,0,6"/>
        <TextBlock Text="{Binding PedidoNumero, StringFormat=Pedido: {0}}" Opacity="0.75"/>
        <TextBlock Text="{Binding OrigemSelecionada, StringFormat=Origem: {0}}" Opacity="0.75"/>
        <TextBlock Text="{Binding ClienteNome, StringFormat=Cliente: {0}}" Opacity="0.75" Margin="0,0,0,10"/>

        <!-- Qualidade: divergências por SKU -->
        <Border Background="#FFF7ED" BorderBrush="#FDBA74" BorderThickness="1" CornerRadius="10" Padding="10" Margin="0,0,0,10"
                Visibility="{Binding DivergenciasDetalhe.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
          <StackPanel>
            <TextBlock Text="Divergência" FontWeight="SemiBold" Foreground="#9A3412"/>
            <TextBlock Text="{Binding MensagemDivergencia}" Opacity="0.85" Margin="0,4,0,6"/>
            <ItemsControl ItemsSource="{Binding DivergenciasDetalhe}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <TextBlock TextWrapping="Wrap" Opacity="0.9">
                    <Run Text="• "/>
                    <Run Text="{Binding}"/>
                  </TextBlock>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <TextBlock Text="Itens esperados do pedido" FontWeight="SemiBold" Margin="0,0,0,6"/>
        <DataGrid ItemsSource="{Binding ItensResumo}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="220">
          <DataGrid.Columns>
            <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="140"/>
            <DataGridTextColumn Header="Descrição" Binding="{Binding Descricao}" Width="*"/>
            <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="80"/>
          </DataGrid.Columns>
        </DataGrid>

        <Separator Margin="0,12,0,12"/>

        <TextBlock Text="Lido (SKU/Descrição/Lote)" FontWeight="SemiBold" Margin="0,0,0,6"/>
        <DataGrid ItemsSource="{Binding ResumoAtual}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
          <DataGrid.Columns>
            <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="140"/>
            <DataGridTextColumn Header="Descrição" Binding="{Binding Descricao}" Width="*"/>
            <DataGridTextColumn Header="Lote" Binding="{Binding Lote}" Width="160"/>
            <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="80"/>
          </DataGrid.Columns>
        </DataGrid>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
          <Button Content="Copiar" Command="{Binding CopiarResumo}" Padding="12,6" Margin="0,0,8,0"/>
          <Button Content="Imprimir" Command="{Binding ImprimirResumo}" Padding="12,6" Background="#4299E1" Foreground="White"/>
        </StackPanel>

        <Separator Margin="0,14,0,10"/>

        <TextBlock Text="Resumo da última sessão" FontWeight="SemiBold" Margin="0,0,0,6"/>
        <TextBlock Text="{Binding LastPedidoNumero, StringFormat=Pedido: {0}}" Opacity="0.75"/>
        <TextBlock Text="{Binding LastOrigem, StringFormat=Origem: {0}}" Opacity="0.75"/>
        <TextBlock Text="{Binding LastClienteNome, StringFormat=Cliente: {0}}" Opacity="0.75" Margin="0,0,0,10"/>

        <DataGrid ItemsSource="{Binding LastResumo}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="220">
          <DataGrid.Columns>
            <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="140"/>
            <DataGridTextColumn Header="Descrição" Binding="{Binding Descricao}" Width="*"/>
            <DataGridTextColumn Header="Lote" Binding="{Binding Lote}" Width="160"/>
            <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="80"/>
          </DataGrid.Columns>
        </DataGrid>
      </StackPanel>
    </Border>

    <Border Style="{StaticResource CardBorder}" Grid.Column="1">
      <StackPanel>
        <TextBlock Text="Últimas tags" FontWeight="SemiBold" Margin="0,0,0,10"/>
        <ListBox ItemsSource="{Binding Recent}" FontFamily="Consolas"/>
      </StackPanel>
    </Border>
  </Grid>
</Grid>

          </Grid>
        </Grid>
      </ScrollViewer>
    </UserControl>
