<UserControl x:Class="MepoExpedicaoRfid.Views.ConsultaTagView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                 mc:Ignorable="d">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Consulta Tag" Style="{StaticResource H1}" Margin="0,0,0,16"/>

          <Grid Grid.Row="1">

<Grid>
  <Grid.RowDefinitions>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="*"/>
  </Grid.RowDefinitions>

  <Border Style="{StaticResource CardBorder}">
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="1*"/>
      </Grid.ColumnDefinitions>

      <StackPanel>
        <TextBlock Text="EPC" Style="{StaticResource Muted}"/>
        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
          <TextBox Width="420" Text="{Binding Epc, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="Cole o EPC ou clique em Ler Tag" Margin="0,0,10,0"/>
          <Button Content="Consultar" Command="{Binding Consultar}" Padding="12,6" Background="#4299E1" Foreground="White" />
        </StackPanel>

        <TextBlock Text="{Binding StatusText}" Opacity="0.75" Margin="0,10,0,0"/>
      </StackPanel>

      <StackPanel Grid.Column="1" HorizontalAlignment="Right">
        <Button Content="Ler Tag (rápido)" Command="{Binding LerDoLeitor}" Padding="12,6" />
      </StackPanel>
    </Grid>
  </Border>

  <Border Style="{StaticResource CardBorder}" Grid.Row="1">
    <StackPanel>
      <TextBlock Text="Dados atuais" FontWeight="SemiBold" Margin="0,0,0,10"/>
      
      <!-- Descrição do Produto -->
      <StackPanel Margin="0,0,0,12">
        <TextBlock Text="Descrição" Opacity="0.75" FontSize="12"/>
        <TextBlock Text="{Binding Current.Descricao, FallbackValue='—', TargetNullValue='—'}" 
                   FontSize="16" 
                   FontWeight="SemiBold"
                   TextWrapping="Wrap"/>
      </StackPanel>
      
      <!-- Grid com 4 colunas -->
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <StackPanel>
          <TextBlock Text="SKU" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.Sku, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14" 
                     FontWeight="SemiBold"/>
        </StackPanel>
        
        <StackPanel Grid.Column="1">
          <TextBlock Text="Lote" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.Lote, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14" 
                     FontWeight="SemiBold"/>
        </StackPanel>
        
        <StackPanel Grid.Column="2">
          <TextBlock Text="Status" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.Status, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14" 
                     FontWeight="SemiBold"/>
        </StackPanel>
        
        <StackPanel Grid.Column="3">
          <TextBlock Text="Atualizado em" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.UpdatedAt, StringFormat={}{0:dd/MM/yy HH:mm}, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14" 
                     FontWeight="SemiBold"/>
        </StackPanel>
      </Grid>
      
      <!-- Datas de Fabricação e Validade -->
      <Grid Margin="0,12,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>
        
        <StackPanel>
          <TextBlock Text="Data de Fabricação" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.DataFabricacao, StringFormat={}{0:dd/MM/yyyy}, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14"/>
        </StackPanel>
        
        <StackPanel Grid.Column="1">
          <TextBlock Text="Data de Validade" Opacity="0.75" FontSize="12"/>
          <TextBlock Text="{Binding Current.DataValidade, StringFormat={}{0:dd/MM/yyyy}, FallbackValue='—', TargetNullValue='—'}" 
                     FontSize="14"/>
        </StackPanel>
      </Grid>
    </StackPanel>
  </Border>

  <Border Style="{StaticResource CardBorder}" Grid.Row="2">
    <StackPanel>
      <TextBlock Text="Histórico completo" FontWeight="SemiBold" Margin="0,0,0,10"/>
      <DataGrid ItemsSource="{Binding Movimentos}" AutoGenerateColumns="False">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Data/Hora" Binding="{Binding CreatedAt, StringFormat={}{0:dd/MM/yyyy HH:mm:ss}}" Width="180"/>
          <DataGridTextColumn Header="Tipo" Binding="{Binding Tipo}" Width="110"/>
          <DataGridTextColumn Header="Pedido" Binding="{Binding NumeroPedido}" Width="140"/>
          <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="140"/>
          <DataGridTextColumn Header="Lote" Binding="{Binding Lote}" Width="140"/>
          <DataGridTextColumn Header="Operador" Binding="{Binding Operador}" Width="*"/>
        </DataGrid.Columns>
      </DataGrid>
    </StackPanel>
  </Border>
</Grid>

          </Grid>
        </Grid>
      </ScrollViewer>
    </UserControl>
