<UserControl x:Class="MepoExpedicaoRfid.Views.DashboardView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                 mc:Ignorable="d">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Dashboard" Style="{StaticResource H1}" Margin="0,0,0,16"/>

          <Grid Grid.Row="1">

<Grid>
  <Grid.RowDefinitions>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
  </Grid.RowDefinitions>

  <Grid Grid.Row="0">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="1*"/>
      <ColumnDefinition Width="1*"/>
      <ColumnDefinition Width="1*"/>
    </Grid.ColumnDefinitions>

    <Border Style="{StaticResource CardBorder}" Grid.Column="0">
    <StackPanel>
      <TextBlock Text="Sessão / Leitura" Style="{StaticResource Muted}"/>
      <TextBlock Text="{Binding SessaoAtual}" FontSize="16" FontWeight="SemiBold" Margin="0,8,0,0"/>
      <DockPanel Margin="0,10,0,0">
        <StackPanel DockPanel.Dock="Left">
          <TextBlock Text="Tags únicas" Opacity="0.7"/>
          <TextBlock Text="{Binding TotalTags}" FontSize="30" FontWeight="Bold"/>
        </StackPanel>
        <StackPanel DockPanel.Dock="Right" HorizontalAlignment="Right">
          <TextBlock Text="Velocidade" Opacity="0.7" HorizontalAlignment="Right"/>
          <TextBlock Text="{Binding ReadsPerSecond}" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Right"/>
        </StackPanel>
      </DockPanel>
      <TextBlock Text="Realtime: {Binding RealtimeStatus, StringFormat={}{0}}" Opacity="0.7" Margin="0,8,0,0"/>
      <TextBlock Text="Impressora: {Binding Impressora, StringFormat={}{0}}" Opacity="0.7" Margin="0,4,0,0"/>
    </StackPanel>
  </Border>

  <Border Style="{StaticResource CardBorder}" Grid.Column="1" Margin="12,0,12,12">
    <StackPanel>
      <TextBlock Text="Fila (resumo)" Style="{StaticResource Muted}"/>

      <Grid Margin="0,12,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
          <ColumnDefinition Width="1*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0">
          <TextBlock Text="Pendentes" Opacity="0.7"/>
          <TextBlock Text="{Binding Pendentes}" FontSize="28" FontWeight="Bold"/>
        </StackPanel>
        <StackPanel Grid.Column="1">
          <TextBlock Text="Em separação" Opacity="0.7"/>
          <TextBlock Text="{Binding EmSeparacao}" FontSize="28" FontWeight="Bold"/>
        </StackPanel>
        <StackPanel Grid.Column="2">
          <TextBlock Text="Finalizados" Opacity="0.7"/>
          <TextBlock Text="{Binding Finalizados}" FontSize="28" FontWeight="Bold"/>
        </StackPanel>
      </Grid>

      <TextBlock Text="Dica: use a FILA para abrir o próximo pedido" Opacity="0.7" Margin="0,10,0,0"/>
    </StackPanel>
  </Border>

  <Border Style="{StaticResource CardBorder}" Grid.Column="2">
    <StackPanel>
      <TextBlock Text="Últimas tags" Style="{StaticResource Muted}"/>
      <ItemsControl ItemsSource="{Binding LastTags}" Margin="0,10,0,0">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding}" FontFamily="Consolas" Opacity="0.85" Margin="0,2,0,2"/>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>
  </Border>
  </Grid>

  <!-- Quadro de avisos -->
  <Border Style="{StaticResource CardBorder}" Grid.Row="1" Margin="0,12,0,0">
    <StackPanel>
      <TextBlock Text="Avisos da expedição" FontWeight="SemiBold" Margin="0,0,0,10"/>

      <TextBlock Text="Nenhum aviso pendente" Opacity="0.65">
        <TextBlock.Style>
          <Style TargetType="TextBlock">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
              <DataTrigger Binding="{Binding AvisosPendentes.Count}" Value="0">
                <Setter Property="Visibility" Value="Visible"/>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <ItemsControl ItemsSource="{Binding AvisosPendentes}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border CornerRadius="10" Padding="10" Margin="0,0,0,8">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#FFFBEB"/>
                  <Setter Property="BorderBrush" Value="#F59E0B"/>
                  <Setter Property="BorderThickness" Value="1"/>
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsSemNf}" Value="True">
                      <Setter Property="Background" Value="#FFF5F5"/>
                      <Setter Property="BorderBrush" Value="#EF4444"/>
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>

              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" FontSize="16" Margin="0,0,10,0">
                  <TextBlock.Style>
                    <Style TargetType="TextBlock">
                      <Setter Property="Text" Value="ℹ️"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSemNf}" Value="True">
                          <Setter Property="Text" Value="⚠️"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </TextBlock.Style>
                </TextBlock>

                <StackPanel Grid.Column="1">
                  <TextBlock FontWeight="SemiBold" TextWrapping="Wrap">
                    <Run Text="#"/>
                    <Run Text="{Binding Numero}"/>
                    <Run Text="  •  "/>
                    <Run Text="{Binding Origem}"/>
                    <Run Text="  •  "/>
                    <Run Text="{Binding ClienteNome}"/>
                  </TextBlock>
                  <TextBlock Text="{Binding Observacao}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                  <TextBlock Opacity="0.7" FontSize="11" Margin="0,6,0,0" TextWrapping="Wrap">
                    <Run Text="Por: "/>
                    <Run Text="{Binding EnviadoPor}"/>
                    <Run Text="  •  "/>
                    <Run Text="{Binding EnviadoAt}"/>
                  </TextBlock>
                </StackPanel>

                <Button Grid.Column="2" Content="✕" Padding="10,4" Background="#00000000" BorderThickness="0"
                        Command="{Binding DataContext.DismissAviso, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        CommandParameter="{Binding}"/>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>
  </Border>
</Grid>

          </Grid>
        </Grid>
      </ScrollViewer>
    </UserControl>
