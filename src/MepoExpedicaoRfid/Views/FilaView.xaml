<UserControl x:Class="MepoExpedicaoRfid.Views.FilaView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                 mc:Ignorable="d">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="24">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Fila de Expedição" Style="{StaticResource H1}" Margin="0,0,0,16"/>

          <Grid Grid.Row="1">

<Grid>
  <Grid.ColumnDefinitions>
    <ColumnDefinition Width="1*"/>
    <ColumnDefinition Width="1*"/>
    <ColumnDefinition Width="1*"/>
  </Grid.ColumnDefinitions>

  <StackPanel Grid.Column="0">
    <DockPanel Margin="0,0,0,10">
      <TextBlock Text="{Binding Pendentes.Count, StringFormat=Pendentes ({0})}" FontWeight="SemiBold" DockPanel.Dock="Left"/>
      <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
        <Button Content="Atualizar" Command="{Binding Refresh}" Padding="8,4" Margin="0,0,8,0"/>
        <Button Content="Abrir" Command="{Binding AbrirItem}" Padding="8,4"/>
      </StackPanel>
    </DockPanel>

    <!-- Filtros/Ordenação -->
    <Grid Margin="0,0,0,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="140"/>
        <ColumnDefinition Width="140"/>
      </Grid.ColumnDefinitions>

      <TextBox Grid.Column="0" Text="{Binding FiltroTexto, UpdateSourceTrigger=PropertyChanged}" Height="30" Margin="0,0,10,0" 
               ToolTip="Filtrar por número do pedido ou cliente"/>

      <ComboBox Grid.Column="1" ItemsSource="{Binding OrigensFiltro}" SelectedItem="{Binding FiltroOrigem}" Height="30" Margin="0,0,10,0"/>

      <CheckBox Grid.Column="2" Content="Prioridade" IsChecked="{Binding OrdenarPorPrioridade}" VerticalAlignment="Center"/>
    </Grid>

    <ListBox ItemsSource="{Binding PendentesView}"
             SelectedItem="{Binding Selected, Mode=TwoWay}"
             BorderThickness="0"
             Background="Transparent"
             ScrollViewer.VerticalScrollBarVisibility="Auto">
      <!-- Opção 2: duplo clique abre -->
      <ListBox.InputBindings>
        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding AbrirItem}" CommandParameter="{Binding Selected}"/>
      </ListBox.InputBindings>
      <ListBox.ItemContainerStyle>
        <Style TargetType="ListBoxItem">
          <Setter Property="Margin" Value="0,0,0,10"/>
          <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          <Setter Property="Background" Value="Transparent"/>

          <!-- Opção 2: ações no botão direito (context menu) -->
          <Setter Property="ContextMenu">
            <Setter.Value>
              <ContextMenu>
                <MenuItem Header="Abrir" 
                          Command="{Binding DataContext.AbrirItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                          CommandParameter="{Binding}"/>
                <MenuItem Header="Reimprimir" 
                          Command="{Binding DataContext.ReimprimirItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                          CommandParameter="{Binding}"/>
              </ContextMenu>
            </Setter.Value>
          </Setter>

          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="ListBoxItem">
                <Border x:Name="Outer" Background="Transparent" CornerRadius="12">
                  <ContentPresenter/>
                </Border>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#4299E1"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="2"/>
                  </Trigger>
                  <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#80CBD5E0"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="1"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ListBox.ItemContainerStyle>

      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border Style="{StaticResource CardBorder}" Padding="0">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="6"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- Faixa de status -->
              <Border Grid.Column="0" CornerRadius="12,0,0,12">
                <Border.Style>
                  <Style TargetType="Border">
                    <Setter Property="Background" Value="#ED8936"/>
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Status}" Value="na_fila">
                        <Setter Property="Background" Value="#ED8936"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="preparando">
                        <Setter Property="Background" Value="#ECC94B"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="processando">
                        <Setter Property="Background" Value="#4299E1"/>
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="finalizada">
                        <Setter Property="Background" Value="#48BB78"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Border.Style>
              </Border>

              <Grid Grid.Column="1" Margin="14,12">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0">
                  <TextBlock Text="{Binding NumeroPedido}" FontSize="18" FontWeight="SemiBold" DockPanel.Dock="Left"/>

                  <Border DockPanel.Dock="Right" Background="#F1F5F9" CornerRadius="999" Padding="8,2" Margin="8,0,0,0">
                    <TextBlock Text="{Binding Origem}" FontSize="12" Opacity="0.8"/>
                  </Border>
                </DockPanel>

                <TextBlock Grid.Row="1" Text="{Binding Cliente}" Opacity="0.8" Margin="0,6,0,0" TextTrimming="CharacterEllipsis"/>

                <DockPanel Grid.Row="2" Margin="0,10,0,0">
                  <Border Background="#F8FAFC" CornerRadius="999" Padding="8,2" DockPanel.Dock="Left">
                    <TextBlock Text="{Binding TotalItens, StringFormat=Itens: {0}}" FontSize="12" Opacity="0.85"/>
                  </Border>
                  <Border Background="#F8FAFC" CornerRadius="999" Padding="8,2" DockPanel.Dock="Left" Margin="8,0,0,0">
                    <TextBlock Text="{Binding Prioridade, StringFormat=Pri: {0}}" FontSize="12" Opacity="0.85"/>
                  </Border>
                  <TextBlock DockPanel.Dock="Right" Text="{Binding CriadoEm, StringFormat={}{0:dd/MM HH:mm}}" FontSize="12" Opacity="0.65"/>
                </DockPanel>
              </Grid>
            </Grid>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>

    <Button Content="Abrir / Criar Sessão" Command="{Binding AbrirPedido}" Padding="10,6" Margin="0,10,0,0"/>
  </StackPanel>

  <StackPanel Grid.Column="1" Margin="12,0,12,0">
    <TextBlock Text="{Binding EmSeparacao.Count, StringFormat=Em separação ({0})}" FontWeight="SemiBold" Margin="0,0,0,10"/>

    <ListBox ItemsSource="{Binding EmSeparacaoView}"
             SelectedItem="{Binding Selected, Mode=TwoWay}"
             BorderThickness="0"
             Background="Transparent"
             ScrollViewer.VerticalScrollBarVisibility="Auto">

      <!-- Duplo clique abre -->
      <ListBox.InputBindings>
        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding AbrirItem}" CommandParameter="{Binding Selected}"/>
      </ListBox.InputBindings>

      <ListBox.ItemContainerStyle>
        <Style TargetType="ListBoxItem">
          <Setter Property="Margin" Value="0,0,0,10"/>
          <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          <Setter Property="Background" Value="Transparent"/>

          <Setter Property="ContextMenu">
            <Setter.Value>
              <ContextMenu>
                <MenuItem Header="Abrir" 
                          Command="{Binding DataContext.AbrirItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                          CommandParameter="{Binding}"/>
                <MenuItem Header="Reimprimir" 
                          Command="{Binding DataContext.ReimprimirItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                          CommandParameter="{Binding}"/>
              </ContextMenu>
            </Setter.Value>
          </Setter>

          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="ListBoxItem">
                <Border x:Name="Outer" Background="Transparent" CornerRadius="12">
                  <ContentPresenter/>
                </Border>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#4299E1"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="2"/>
                  </Trigger>
                  <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#80CBD5E0"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="1"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ListBox.ItemContainerStyle>

      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border Style="{StaticResource CardBorder}" Padding="0">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="6"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <Border Grid.Column="0" Background="#4299E1" CornerRadius="12,0,0,12"/>

              <Grid Grid.Column="1" Margin="14,12">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0">
                  <TextBlock Text="{Binding NumeroPedido}" FontSize="18" FontWeight="SemiBold" DockPanel.Dock="Left"/>
                  <Border DockPanel.Dock="Right" Background="#F1F5F9" CornerRadius="999" Padding="8,2" Margin="8,0,0,0">
                    <TextBlock Text="{Binding Origem}" FontSize="12" Opacity="0.8"/>
                  </Border>
                </DockPanel>

                <TextBlock Grid.Row="1" Text="{Binding Cliente}" Opacity="0.8" Margin="0,8,0,0" TextTrimming="CharacterEllipsis"/>

                <DockPanel Grid.Row="2" Margin="0,12,0,0">
                  <Border Background="#EFF6FF" BorderBrush="#BFDBFE" BorderThickness="1" CornerRadius="999" Padding="8,2" DockPanel.Dock="Left">
                    <TextBlock Text="EM SEPARAÇÃO" FontSize="11" FontWeight="SemiBold" Foreground="#1D4ED8"/>
                  </Border>
                  <TextBlock DockPanel.Dock="Right" Text="{Binding IniciadoEm, StringFormat=Início: {0:dd/MM HH:mm}}" FontSize="12" Opacity="0.65"/>
                </DockPanel>
              </Grid>
            </Grid>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>

    </ListBox>
  </StackPanel>

  <StackPanel Grid.Column="2">
    <TextBlock Text="{Binding Finalizados.Count, StringFormat=Finalizados ({0})}" FontWeight="SemiBold" Margin="0,0,0,10"/>

    <ListBox ItemsSource="{Binding FinalizadosView}"
             SelectedItem="{Binding Selected, Mode=TwoWay}"
             BorderThickness="0"
             Background="Transparent"
             ScrollViewer.VerticalScrollBarVisibility="Auto">

      <ListBox.ItemContainerStyle>
        <Style TargetType="ListBoxItem">
          <Setter Property="Margin" Value="0,0,0,10"/>
          <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          <Setter Property="Background" Value="Transparent"/>

          <Setter Property="ContextMenu">
            <Setter.Value>
              <ContextMenu>
                <MenuItem Header="Reimprimir" 
                          Command="{Binding DataContext.ReimprimirItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                          CommandParameter="{Binding}"/>
              </ContextMenu>
            </Setter.Value>
          </Setter>

          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="ListBoxItem">
                <Border x:Name="Outer" Background="Transparent" CornerRadius="12">
                  <ContentPresenter/>
                </Border>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#4299E1"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="2"/>
                  </Trigger>
                  <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Outer" Property="BorderBrush" Value="#80CBD5E0"/>
                    <Setter TargetName="Outer" Property="BorderThickness" Value="1"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ListBox.ItemContainerStyle>

      <ListBox.ItemTemplate>
        <DataTemplate>
          <Border Style="{StaticResource CardBorder}" Padding="0">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="6"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <Border Grid.Column="0" Background="#48BB78" CornerRadius="12,0,0,12"/>

              <Grid Grid.Column="1" Margin="14,12">
                <DockPanel>
                  <TextBlock Text="{Binding NumeroPedido}" FontSize="18" FontWeight="SemiBold" DockPanel.Dock="Left"/>
                  <Border DockPanel.Dock="Right" Background="#F1F5F9" CornerRadius="999" Padding="8,2" Margin="8,0,0,0">
                    <TextBlock Text="{Binding Origem}" FontSize="12" Opacity="0.8"/>
                  </Border>
                </DockPanel>

                <TextBlock Text="{Binding Cliente}" Opacity="0.8" Margin="0,6,0,0" TextTrimming="CharacterEllipsis"/>

                <DockPanel Margin="0,10,0,0">
                  <TextBlock DockPanel.Dock="Left" Text="{Binding TotalItens, StringFormat=Itens: {0}}" FontSize="12" Opacity="0.75"/>
                  <TextBlock DockPanel.Dock="Right" Text="{Binding FinalizadoEm, StringFormat=Finalizado: {0:dd/MM HH:mm}}" FontSize="12" Opacity="0.65"/>
                </DockPanel>
              </Grid>
            </Grid>
          </Border>
        </DataTemplate>
      </ListBox.ItemTemplate>

    </ListBox>
  </StackPanel>
</Grid>

          </Grid>
        </Grid>
      </ScrollViewer>
    </UserControl>
